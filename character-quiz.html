<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADnDI - Character Quiz</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <h1>Character Quiz</h1>
        <form id="characterForm">
            <div class="form-group">
                <label for="characterName">Character Name:</label>
                <input type="text" id="characterName" required>
            </div>
            
            <div class="form-group">
                <label for="characterLevel">Level:</label>
                <input type="number" id="characterLevel" min="1" max="20" value="1" required>
            </div>
            
            <!-- Core Fantasy Archetype -->
            <div class="form-group">
                <label>Core Fantasy Archetype:</label>
                <div class="options-grid">
                    <label><input type="radio" name="archetype" value="Barbarian" required> Barbarian</label>
                    <label><input type="radio" name="archetype" value="Bard"> Bard</label>
                    <label><input type="radio" name="archetype" value="Cleric"> Cleric</label>
                    <label><input type="radio" name="archetype" value="Druid"> Druid</label>
                    <label><input type="radio" name="archetype" value="Fighter"> Fighter</label>
                    <label><input type="radio" name="archetype" value="Monk"> Monk</label>
                    <label><input type="radio" name="archetype" value="Paladin"> Paladin</label>
                    <label><input type="radio" name="archetype" value="Ranger"> Ranger</label>
                    <label><input type="radio" name="archetype" value="Rogue"> Rogue</label>
                    <label><input type="radio" name="archetype" value="Sorcerer"> Sorcerer</label>
                    <label><input type="radio" name="archetype" value="Warlock"> Warlock</label>
                    <label><input type="radio" name="archetype" value="Wizard"> Wizard</label>
                </div>
            </div>
            
            <!-- Background/Origin -->
            <div class="form-group">
                <label for="background">Background/Origin:</label>
                <select id="background" required>
                    <option value="">Select...</option>
                    <option value="city">In a bustling city full of intrigue</option>
                    <option value="village">A remote village surrounded by forest</option>
                    <option value="ruins">Deep underground in ancient ruins</option>
                    <option value="clouds">A floating city in the clouds</option>
                    <option value="desert">A nomadic tribe crossing deserts</option>
                    <option value="royalty">Among royalty in a majestic castle</option>
                </select>
            </div>
            
            <!-- Hair -->
            <div class="form-group">
                <label for="hair">Hair:</label>
                <input type="text" id="hair" placeholder="Describe your character's hair">
            </div>
            
            <!-- Attitude toward conflict -->
            <div class="form-group">
                <label>Attitude toward conflict:</label>
                <div class="options-grid">
                    <label><input type="radio" name="conflict" value="peace" required> Always looking for peace</label>
                    <label><input type="radio" name="conflict" value="calm"> Calm until provoked</label>
                    <label><input type="radio" name="conflict" value="fight"> Loves a good fight</label>
                    <label><input type="radio" name="conflict" value="think"> Thinks first, then acts</label>
                    <label><input type="radio" name="conflict" value="manipulate"> Manipulates others to avoid conflict</label>
                    <label><input type="radio" name="conflict" value="chaos"> Welcomes chaos but never participates</label>
                </div>
            </div>
            
            <!-- Most defining trait -->
            <div class="form-group">
                <label>Most defining trait:</label>
                <div class="options-grid">
                    <label><input type="radio" name="trait" value="loyalty" required> Loyalty</label>
                    <label><input type="radio" name="trait" value="curiosity"> Curiosity</label>
                    <label><input type="radio" name="trait" value="ambition"> Ambition</label>
                    <label><input type="radio" name="trait" value="humor"> Humor</label>
                    <label><input type="radio" name="trait" value="mystery"> Mystery</label>
                    <label><input type="radio" name="trait" value="honor"> Honor</label>
                </div>
            </div>
            
            <!-- Companion -->
            <div class="form-group">
                <label>Companion:</label>
                <div class="options-grid">
                    <label><input type="radio" name="companion" value="owl" required> A wise owl</label>
                    <label><input type="radio" name="companion" value="wolf"> A fiery wolf</label>
                    <label><input type="radio" name="companion" value="fox"> A sly fox</label>
                    <label><input type="radio" name="companion" value="dragon"> A miniature dragon</label>
                    <label><input type="radio" name="companion" value="cat"> A shadowy cat</label>
                </div>
            </div>
            
            <!-- Inner Struggle -->
            <div class="form-group">
                <label>Inner Struggle:</label>
                <div class="options-grid">
                    <label><input type="radio" name="struggle" value="curse" required> A cursed part</label>
                    <label><input type="radio" name="struggle" value="love"> Forbidden love</label>
                    <label><input type="radio" name="struggle" value="greed"> Greed for power</label>
                    <label><input type="radio" name="struggle" value="demon"> A literal demon within</label>
                    <label><input type="radio" name="struggle" value="doubt"> Self-doubt</label>
                    <label><input type="radio" name="struggle" value="peace"> Nothing, they protect their peace</label>
                </div>
            </div>
            
            <button type="submit" class="btn-primary">Generate your character</button>
        </form>
    </div>

    <script src="js/app.js"></script>
    <script>
        document.getElementById('characterForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('characterName').value,
                level: document.getElementById('characterLevel').value,
                archetype: document.querySelector('input[name="archetype"]:checked').value,
                background: document.getElementById('background').value,
                hair: document.getElementById('hair').value,
                conflict: document.querySelector('input[name="conflict"]:checked').value,
                trait: document.querySelector('input[name="trait"]:checked').value,
                companion: document.querySelector('input[name="companion"]:checked').value,
                struggle: document.querySelector('input[name="struggle"]:checked').value
            };
            
            // Generate character description
            const descriptionPrompt = `Create a D&D character description based on these traits:
                Name: ${formData.name}
                Level: ${formData.level}
                Class: ${formData.archetype}
                Background: ${formData.background}
                Hair: ${formData.hair}
                Conflict attitude: ${formData.conflict}
                Defining trait: ${formData.trait}
                Companion: ${formData.companion}
                Inner struggle: ${formData.struggle}
                
                Include physical appearance, personality, and abilities in 2-3 sentences.`;
            
            try {
                // Call API to generate description
                const descriptionResponse = await makeAPIRequest('chat', {
                    model: "hackathon/qwen3",
                    messages: [{ role: "user", content: descriptionPrompt }],
                    temperature: 0.7
                });
                
                const description = descriptionResponse.choices?.[0]?.message?.content || "A brave adventurer";
                
                // Generate character image
                const imagePrompt = `D&D ${formData.archetype} character: ${description}, fantasy art style, detailed`;
                const imageResponse = await makeAPIRequest('image', {
                    model: "hackathon/text2image",
                    prompt: imagePrompt,
                    n: 1,
                    size: "512x512"
                });
                
                const imageUrl = imageResponse.data?.[0]?.url;
                
                // Create character object
                const character = {
                    name: formData.name,
                    level: formData.level,
                    type: formData.archetype,
                    description: description,
                    image: imageUrl,
                    stats: {
                        hp: 10 + parseInt(formData.level) * 5,
                        attack: 3 + parseInt(formData.level),
                        defense: 2 + parseInt(formData.level)
                    }
                };
                
                // Save character and redirect
                let characters = JSON.parse(localStorage.getItem('adndiCharacters') || []);
                characters.push(character);
                localStorage.setItem('adndiCharacters', JSON.stringify(characters));
                window.location.href = 'character-creation.html';
                
            } catch (error) {
                console.error('Error generating character:', error);
                alert('Failed to generate character. Please try again.');
            }
        });
    </script>
</body>
</html>